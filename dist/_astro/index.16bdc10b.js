import{j as t,c as ze}from"./utils.cba2a83f.js";import{r}from"./index.7050ffa8.js";import{S as Se}from"./skeleton.d47ea41f.js";import{B as T}from"./button.106a523c.js";import{P as Pe}from"./index.8f609134.js";import{c as E}from"./createLucideIcon.b27e170f.js";import{L as Ee}from"./loader-circle.ea940e81.js";import{M as J}from"./map-pin.3ff91f5a.js";import{X as Ie}from"./x.deec9580.js";import{H as Ce}from"./house.38e72fb6.js";import"./index.9370a71d.js";import"./index.7ef91352.js";import"./index.e2f97c53.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Te=E("CircleAlert",Re);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],Oe=E("Globe",$e);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]],_e=E("Mail",Fe);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],Ue=E("Navigation",De);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]],He=E("Phone",qe);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],Ve=E("ZoomIn",Ze);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],We=E("ZoomOut",Be);var Xe="Separator",ie="horizontal",Ye=["horizontal","vertical"],me=r.forwardRef((l,x)=>{const{decorative:y,orientation:z=ie,...I}=l,h=Ge(z)?z:ie,Z=y?{role:"none"}:{"aria-orientation":h==="vertical"?h:void 0,role:"separator"};return t.jsx(Pe.div,{"data-orientation":h,...Z,...I,ref:x})});me.displayName=Xe;function Ge(l){return Ye.includes(l)}var de=me;const xe=r.forwardRef(({className:l,orientation:x="horizontal",decorative:y=!0,...z},I)=>t.jsx(de,{ref:I,decorative:y,orientation:x,className:ze("shrink-0 bg-border",x==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",l),...z}));xe.displayName=de.displayName;const A=[21.5218,-77.7812],L=7,Je=15,Ke="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",ue=["a","b","c"],Qe=({businesses:l=[],center:x,zoom:y,className:z="h-full w-full",forceFitBounds:I=!0})=>{const h=r.useRef(null),[O,Z]=r.useState(!0),[K,Q]=r.useState(0),[F,ee]=r.useState(null),[f,V]=r.useState(null),[te,B]=r.useState(null),[_,$]=r.useState(!1),d=r.useRef(x||A),u=r.useRef(y||L),[re,N]=r.useState(x||A),[C,g]=r.useState(y||L),[W,he]=r.useState([]),[X,fe]=r.useState([0,0]),[Y,ne]=r.useState([0,0]),D=r.useRef(!1),U=r.useRef([0,0]),o=r.useRef(null),ae=r.useRef(0),pe=r.useRef({}),w=r.useMemo(()=>l.filter(e=>e&&e.latitude!=null&&e.longitude!=null&&!isNaN(Number(e.latitude))&&!isNaN(Number(e.longitude))),[l]),ge=r.useCallback(e=>{pe.current[e]=!0},[]),q=r.useCallback((e,n,a)=>{const i=Math.pow(2,a)*256,j=(n+180)/360*i,v=(1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*i;return[j-X[0],v-X[1]]},[X]),se=r.useCallback((e,n,a)=>{const s=ue[Math.abs(e+n)%ue.length];return Ke.replace("{s}",s).replace("{z}",a.toString()).replace("{x}",e.toString()).replace("{y}",n.toString())},[]),c=r.useCallback(()=>{if(!h.current)return;const e=Date.now();if(e-ae.current<100){o.current&&cancelAnimationFrame(o.current),o.current=requestAnimationFrame(c);return}ae.current=e,o.current=null;const n=h.current.clientWidth,a=h.current.clientHeight;if(n===0||a===0){setTimeout(c,100);return}ne([n,a]);const s=u.current,i=d.current,j=Math.pow(2,s),v=j*256,S=[(i[1]+180)/360*v,(1-Math.log(Math.tan(i[0]*Math.PI/180)+1/Math.cos(i[0]*Math.PI/180))/Math.PI)/2*v],m=[S[0]-n/2,S[1]-a/2];fe(m);const p=256,b=Math.floor(m[0]/p),P=Math.floor(m[1]/p),R=Math.ceil((m[0]+n)/p),ke=Math.ceil((m[1]+a)/p),le=[];for(let M=b;M<R;M++)for(let k=P;k<ke;k++){if(M<0||k<0||M>=j||k>=j)continue;const Ae=M*p-m[0],Le=k*p-m[1];le.push({key:`${s}-${M}-${k}`,url:se(M,k,s),x:M,y:k,z:s,left:Ae,top:Le})}he(le)},[se]),H=r.useCallback(e=>{let n;switch(e.code){case e.PERMISSION_DENIED:n="Usuario denegó la solicitud de geolocalización";break;case e.POSITION_UNAVAILABLE:n="Información de ubicación no disponible. Intenta en un área con mejor cobertura GPS/WiFi";break;case e.TIMEOUT:n="La solicitud para obtener la ubicación del usuario expiró";break;default:n="Error desconocido al obtener la ubicación"}console.warn(`Error de geolocalización: ${n}`,e),B(n),$(!1)},[]),G=r.useCallback(()=>{if(!navigator.geolocation){B("Tu navegador no soporta geolocalización");return}$(!0),B(null);try{const e=navigator.geolocation.watchPosition(n=>{const{latitude:a,longitude:s}=n.coords;V([a,s]),d.current=[a,s],N([a,s]),u.current=13,g(13),$(!1),navigator.geolocation.clearWatch(e),o.current&&cancelAnimationFrame(o.current),o.current=requestAnimationFrame(c)},n=>{H(n),navigator.geolocation.clearWatch(e),navigator.geolocation.getCurrentPosition(a=>{const{latitude:s,longitude:i}=a.coords;V([s,i]),d.current=[s,i],N([s,i]),u.current=13,g(13),$(!1),o.current&&cancelAnimationFrame(o.current),o.current=requestAnimationFrame(c)},H,{enableHighAccuracy:!1,timeout:15e3,maximumAge:6e4})},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})}catch{navigator.geolocation.getCurrentPosition(n=>{const{latitude:a,longitude:s}=n.coords;V([a,s]),d.current=[a,s],N([a,s]),u.current=13,g(13),$(!1),o.current&&cancelAnimationFrame(o.current),o.current=requestAnimationFrame(c)},H,{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})}},[c,H]);r.useEffect(()=>{!x&&!I&&navigator.geolocation&&G()},[]),r.useEffect(()=>{if(w.length>0&&I)try{let e=90,n=-90,a=180,s=-180;w.forEach(p=>{const b=Number(p.latitude),P=Number(p.longitude);e=Math.min(e,b),n=Math.max(n,b),a=Math.min(a,P),s=Math.max(s,P)});const i=Math.max((n-e)*.2,.1),j=Math.max((s-a)*.2,.1),v=(e+n)/2,S=(a+s)/2;let m;if(w.length===1)m=Je;else{const p=n-e+i*2,b=s-a+j*2,P=Math.log2(180/p),R=Math.log2(360/b);m=Math.min(P,R,18),m=Math.max(Math.floor(m),5)}d.current=[v,S],u.current=m,N([v,S]),g(m)}catch{d.current=x||A,u.current=y||L,N(x||A),g(y||L)}else x&&y?(d.current=x,u.current=y,N(x),g(y)):f?(d.current=f,u.current=13,N(f),g(13)):(d.current=A,u.current=L,N(A),g(L))},[]),r.useEffect(()=>{d.current=re},[re]),r.useEffect(()=>{u.current=C},[C]),r.useEffect(()=>{c();const e=()=>{o.current&&cancelAnimationFrame(o.current),o.current=requestAnimationFrame(c)};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e),o.current&&cancelAnimationFrame(o.current)}},[c]),r.useEffect(()=>{const e=setInterval(()=>{Q(a=>{const s=a<30?5:a<70?2:4;return Math.min(a+s,95)})},150),n=setTimeout(()=>{clearInterval(e),Q(100),Z(!1)},1500);return()=>{clearTimeout(n),clearInterval(e)}},[]),r.useEffect(()=>{if(!O&&h.current){const e=setTimeout(()=>{c(),setTimeout(()=>{c()},300),setTimeout(()=>{h.current&&W.length===0&&(h.current&&(ne([h.current.clientWidth,h.current.clientHeight]),c()))},800)},200);return()=>clearTimeout(e)}},[O,c,W.length]);const ye=r.useCallback(e=>{e.button===0&&(D.current=!0,U.current=[e.clientX,e.clientY])},[]),Ne=r.useCallback(e=>{if(!D.current)return;const n=e.clientX-U.current[0],a=e.clientY-U.current[1],i=Math.pow(2,u.current)*256,j=-n*360/i,v=a*180/i,[S,m]=d.current,p=S+v,b=m+j,R=[Math.max(-85,Math.min(85,p)),b];d.current=R,N(R),U.current=[e.clientX,e.clientY],o.current&&cancelAnimationFrame(o.current),o.current=requestAnimationFrame(c)},[c]),oe=r.useCallback(()=>{D.current&&(D.current=!1)},[]),je=r.useCallback(()=>{const e=Math.min(18,u.current+1);u.current=e,g(e),o.current&&cancelAnimationFrame(o.current),o.current=requestAnimationFrame(c)},[c]),ve=r.useCallback(()=>{const e=Math.max(1,u.current-1);u.current=e,g(e),o.current&&cancelAnimationFrame(o.current),o.current=requestAnimationFrame(c)},[c]),we=r.useCallback(()=>{d.current=A,u.current=L,N(A),g(L),o.current&&cancelAnimationFrame(o.current),o.current=requestAnimationFrame(c)},[c]),be=r.useCallback(()=>{_||(f?(d.current=f,u.current=13,N(f),g(13),o.current&&cancelAnimationFrame(o.current),o.current=requestAnimationFrame(c)):G())},[c,G,_,f]),ce=r.useCallback(e=>{ee(n=>n===e?null:e)},[]),Me=r.useMemo(()=>w.map(e=>{const n=Number(e.latitude),a=Number(e.longitude),[s,i]=q(n,a,C),j=s>=-20&&s<=Y[0]+20&&i>=-20&&i<=Y[1]+20;return{business:e,x:s,y:i,isVisible:j}}),[w,q,C,Y]);return O?t.jsxs("div",{className:`${z} border rounded-md bg-gray-50 flex flex-col justify-center items-center relative overflow-hidden`,style:{minHeight:"400px"},children:[t.jsx("div",{className:"absolute inset-0 bg-blue-50/80"}),t.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4 z-10",children:[t.jsxs("div",{className:"text-primary flex items-center justify-center flex-col",children:[t.jsx(Oe,{className:"h-16 w-16 text-primary/60 animate-pulse"}),t.jsx("div",{className:"animate-spin mt-2",children:t.jsx(Ee,{className:"h-8 w-8 text-primary"})})]}),t.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Cargando mapa..."}),t.jsx("div",{className:"w-64 h-2 bg-gray-200 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full bg-primary transition-all duration-300 ease-out",style:{width:`${K}%`}})}),t.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Preparando visualización del mapa ",K,"%"]})]}),t.jsx("div",{className:"absolute inset-0 z-0",children:t.jsx(Se,{className:"h-full w-full opacity-30"})})]}):t.jsxs("div",{ref:h,className:`${z} relative overflow-hidden bg-blue-50 border rounded-md select-none`,style:{minHeight:"400px"},onMouseDown:ye,onMouseMove:Ne,onMouseUp:oe,onMouseLeave:oe,children:[t.jsx("div",{className:"absolute inset-0 bg-blue-100"}),t.jsx("div",{className:"absolute inset-0 overflow-hidden",children:W.map(e=>t.jsx("img",{src:e.url,alt:"",crossOrigin:"anonymous",referrerPolicy:"origin",className:"absolute select-none pointer-events-none",style:{left:`${e.left}px`,top:`${e.top}px`,width:"256px",height:"256px"},onLoad:()=>ge(e.key),onDragStart:n=>n.preventDefault()},e.key))}),f&&t.jsxs("div",{className:"absolute z-40 transform -translate-x-1/2 -translate-y-1/2 pointer-events-none",style:{left:`${q(f[0],f[1],C)[0]}px`,top:`${q(f[0],f[1],C)[1]}px`},children:[t.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center animate-pulse",children:t.jsx("div",{className:"w-3 h-3 bg-white rounded-full"})}),t.jsx("div",{className:"w-12 h-12 bg-blue-500/30 rounded-full absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"})]}),t.jsx("div",{className:"absolute inset-0 pointer-events-none",children:Me.filter(e=>e.isVisible).map(({business:e,x:n,y:a})=>t.jsx("div",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 pointer-events-auto",style:{left:`${n}px`,top:`${a}px`},onClick:()=>ce(e.id),children:t.jsxs("div",{className:`flex flex-col items-center group ${F===e.id?"z-30":"z-20"}`,children:[t.jsx("div",{className:`bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center shadow-md cursor-pointer 
                                    hover:bg-red-600 transition-all duration-200 ${e.promoted?"animate-pulse":""} 
                                    ${F===e.id?"ring-4 ring-primary/50":""}`,children:t.jsx(J,{className:"h-4 w-4"})}),t.jsx("div",{className:`absolute -bottom-8 left-1/2 transform -translate-x-1/2 bg-white px-2 py-0.5 rounded shadow-md 
                                    text-xs font-medium opacity-0 group-hover:opacity-100 transition-opacity duration-200 w-max`,children:e.name}),F===e.id&&t.jsx("div",{className:"absolute top-8 left-1/2 transform -translate-x-1/2 z-50 w-[280px]",children:t.jsx("div",{className:"bg-white rounded-md shadow-lg p-3 max-w-xs",children:t.jsxs("div",{className:"flex justify-between items-start mb-1",children:[t.jsx("div",{className:"flex-1",children:t.jsx(et,{business:e})}),t.jsx(T,{size:"icon",variant:"ghost",className:"h-6 w-6 -mt-1 -mr-1",onClick:s=>{s.stopPropagation(),ee(null)},children:t.jsx(Ie,{className:"h-4 w-4"})})]})})})]})},e.id))}),t.jsxs("div",{className:"absolute bottom-0 right-0 bg-white/80 px-2 py-0.5 text-[10px] z-50",children:["© ",t.jsx("a",{href:"https://www.openstreetmap.org/copyright",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"OpenStreetMap"})," contributors"]}),t.jsxs("div",{className:"absolute top-2 right-2 flex flex-col gap-1 z-50",children:[t.jsx(T,{size:"icon",variant:"secondary",onClick:je,title:"Acercar",children:t.jsx(Ve,{className:"h-4 w-4"})}),t.jsx(T,{size:"icon",variant:"secondary",onClick:ve,title:"Alejar",children:t.jsx(We,{className:"h-4 w-4"})}),t.jsx(T,{size:"icon",variant:"secondary",onClick:we,title:"Centrar en Cuba",children:t.jsx(Ce,{className:"h-4 w-4"})}),t.jsx(T,{size:"icon",variant:"secondary",onClick:be,title:"Mi ubicación",disabled:_,className:`${f?"bg-blue-100 text-blue-700 hover:bg-blue-200":""} ${_?"animate-pulse":""}`,children:t.jsx(Ue,{className:"h-4 w-4"})})]}),te&&t.jsxs("div",{className:"absolute top-2 left-1/2 transform -translate-x-1/2 bg-red-100 border border-red-400 text-red-700 px-3 py-1.5 rounded z-50 text-xs flex items-center gap-1.5",children:[t.jsx(Te,{className:"h-4 w-4"}),te]}),w.length>0&&t.jsxs("div",{className:"absolute top-2 left-2 bg-white rounded-md shadow-md p-2 max-w-xs z-40",children:[t.jsx("div",{className:"flex justify-between items-center mb-1",children:t.jsxs("h4",{className:"font-semibold text-sm text-gray-800",children:["Negocios (",w.length,")"]})}),t.jsx("div",{className:"max-h-40 overflow-y-auto",children:t.jsx("ul",{className:"space-y-1",children:w.map(e=>t.jsxs("li",{className:`text-xs flex items-center gap-1 px-1.5 py-1 rounded cursor-pointer ${F===e.id?"bg-blue-100":"hover:bg-gray-100"}`,onClick:()=>ce(e.id),children:[t.jsx(J,{className:"h-3 w-3 text-red-500 flex-shrink-0"}),t.jsx("span",{className:"truncate font-semibold text-gray-700",children:e.name}),t.jsx("span",{className:"ml-1 text-[10px] text-gray-500 font-medium",children:e.location})]},e.id))})})]})]})};function et({business:l}){return t.jsxs("div",{className:"w-full space-y-1.5",children:[t.jsx("h3",{className:"font-semibold text-sm",children:l.name}),l.promoted&&t.jsx("span",{className:"bg-yellow-500 text-black text-[10px] px-1.5 py-0.5 border border-yellow-600 rounded font-semibold inline-block",children:"★ DESTACADO"}),t.jsx("p",{className:"text-xs text-muted-foreground",children:l.category}),t.jsx(xe,{className:"my-1"}),t.jsxs("div",{className:"space-y-0.5 text-xs",children:[t.jsxs("div",{className:"flex items-start gap-1.5",children:[t.jsx(J,{className:"h-3.5 w-3.5 mt-0.5 text-muted-foreground flex-shrink-0"}),t.jsx("span",{children:l.address})]}),l.phone&&t.jsxs("div",{className:"flex items-start gap-1.5",children:[t.jsx(He,{className:"h-3.5 w-3.5 mt-0.5 text-muted-foreground flex-shrink-0"}),t.jsx("span",{children:l.phone})]}),l.email&&t.jsxs("div",{className:"flex items-start gap-1.5",children:[t.jsx(_e,{className:"h-3.5 w-3.5 mt-0.5 text-muted-foreground flex-shrink-0"}),t.jsx("a",{href:`mailto:${l.email}`,className:"text-primary hover:underline truncate",children:l.email})]})]}),t.jsx(T,{asChild:!0,size:"sm",className:"w-full mt-1.5 h-7",children:t.jsx("a",{href:`/business/${l.id}`,children:"Ver Detalles"})})]})}const ht=l=>t.jsx(Qe,{...l});export{ht as default};
