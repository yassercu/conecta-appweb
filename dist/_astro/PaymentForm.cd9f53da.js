import{r as n}from"./index.7050ffa8.js";import{j as s,c}from"./utils.cba2a83f.js";import{O as $,C as z,b as ie,a as L,D as B,P as ce,R as le}from"./index.1f3fba3a.js";import{X as de}from"./x.deec9580.js";import{B as pe}from"./button.106a523c.js";import{C as U}from"./card.5c9e26d9.js";import{I as A}from"./input.e1ecff9e.js";import{L as S}from"./label.1e59a270.js";import{c as ue}from"./index.7ef91352.js";import{t as F}from"./use-toast.9f8ff5c3.js";import{c as j}from"./createLucideIcon.b27e170f.js";import{C as me}from"./credit-card.271c7e58.js";import{A as ge,a as he,b as fe,c as xe,d as ye,e as ve,f as k}from"./alert-dialog.254035c4.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]],C=j("Building",Ne);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]],Ee=j("MessageCircle",je);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Te=j("Send",be);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],_e=j("Wallet",Pe),we=1,Ae=1e6;let D=0;function Se(){return D=(D+1)%Number.MAX_SAFE_INTEGER,D.toString()}const M=new Map,I=e=>{if(M.has(e))return;const a=setTimeout(()=>{M.delete(e),x({type:"REMOVE_TOAST",toastId:e})},Ae);M.set(e,a)},Ce=(e,a)=>{switch(a.type){case"ADD_TOAST":return{...e,toasts:[a.toast,...e.toasts].slice(0,we)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(o=>o.id===a.toast.id?{...o,...a.toast}:o)};case"DISMISS_TOAST":{const{toastId:o}=a;return o?I(o):e.toasts.forEach(t=>{I(t.id)}),{...e,toasts:e.toasts.map(t=>t.id===o||o===void 0?{...t,open:!1}:t)}}case"REMOVE_TOAST":return a.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(o=>o.id!==a.toastId)}}},v=[];let N={toasts:[]};function x(e){N=Ce(N,e),v.forEach(a=>{a(N)})}function De({...e}){const a=Se(),o=i=>x({type:"UPDATE_TOAST",toast:{...i,id:a}}),t=()=>x({type:"DISMISS_TOAST",toastId:a});return x({type:"ADD_TOAST",toast:{...e,id:a,open:!0,onOpenChange:i=>{i||t()}}}),{id:a,dismiss:t,update:o}}function ts(){const[e,a]=n.useState(N);return n.useEffect(()=>(v.push(a),()=>{const o=v.indexOf(a);o>-1&&v.splice(o,1)}),[e]),{...e,toast:De,dismiss:o=>x({type:"DISMISS_TOAST",toastId:o})}}const Me=le,Oe=ce,H=n.forwardRef(({className:e,...a},o)=>s.jsx($,{ref:o,className:c("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...a}));H.displayName=$.displayName;const W=n.forwardRef(({className:e,children:a,...o},t)=>s.jsxs(Oe,{children:[s.jsx(H,{}),s.jsxs(z,{ref:t,className:c("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...o,children:[a,s.jsxs(ie,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[s.jsx(de,{className:"h-4 w-4"}),s.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));W.displayName=z.displayName;const Y=({className:e,...a})=>s.jsx("div",{className:c("flex flex-col space-y-1.5 text-center sm:text-left",e),...a});Y.displayName="DialogHeader";const V=({className:e,...a})=>s.jsx("div",{className:c("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...a});V.displayName="DialogFooter";const Z=n.forwardRef(({className:e,...a},o)=>s.jsx(L,{ref:o,className:c("text-lg font-semibold leading-none tracking-tight",e),...a}));Z.displayName=L.displayName;const K=n.forwardRef(({className:e,...a},o)=>s.jsx(B,{ref:o,className:c("text-sm text-muted-foreground",e),...a}));K.displayName=B.displayName;const Re=ue("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),q=n.forwardRef(({className:e,variant:a,...o},t)=>s.jsx("div",{ref:t,role:"alert",className:c(Re({variant:a}),e),...o}));q.displayName="Alert";const Ue=n.forwardRef(({className:e,...a},o)=>s.jsx("h5",{ref:o,className:c("mb-1 font-medium leading-none tracking-tight",e),...a}));Ue.displayName="AlertTitle";const J=n.forwardRef(({className:e,...a},o)=>s.jsx("div",{ref:o,className:c("text-sm [&_p]:leading-relaxed",e),...a}));J.displayName="AlertDescription";const ke=async e=>{console.log("== DEBUG WhatsApp Payment =="),console.log("paymentInfo recibido:",e),console.log("businessPhone:",e.businessPhone),console.log("tipo de businessPhone:",typeof e.businessPhone),console.log("¿businessPhone está vacío?:",!e.businessPhone),console.log("¿businessPhone es undefined?:",e.businessPhone===void 0),console.log("¿businessPhone es cadena vacía?:",e.businessPhone===""),console.log("=========================");const a={}.PUBLIC_SUPPORT_PHONE||"5355555555",o=e.metadata?.type==="plan_subscription";let t="";if(o)t=a,console.log("Usando teléfono de soporte:",t);else if(t=e.businessPhone||"",console.log("Usando teléfono del negocio:",t),!t||t.trim()==="")return console.error("No se proporcionó un número de teléfono válido para el negocio"),{success:!1,message:"Este negocio no tiene número de WhatsApp configurado"};let i="";o?i=`¡Hola! Me interesa contratar el plan ${e.concept} por un valor de ${e.amount} ${e.currency}. Por favor, necesito información para realizar el pago.`:i=`¡Hola! Me interesa realizar un pedido de ${e.concept} por un total de ${e.amount} ${e.currency}`,console.log("Enviando mensaje de WhatsApp al número:",t);const m=`https://wa.me/${t}?text=${encodeURIComponent(i)}`;return window.open(m,"_blank"),{success:!0,status:"pending",message:o?"Abriendo chat de WhatsApp para coordinar la contratación del plan con el soporte...":"Abriendo chat de WhatsApp para coordinar el pedido con el negocio...",meta:{contactType:o?"support":"business",contactNumber:t}}},Ie=async e=>{const a=`¡Hola! Me interesa realizar un pedido de ${e.concept} por un total de ${e.amount} ${e.currency}`,o=e.businessContact||"soporte@plataforma.com (predeterminado)";return console.log("===== MENSAJE DIRECTO ====="),console.log(`Destinatario: ${o}`),console.log(`Mensaje: ${a}`),console.log("=========================="),typeof window<"u"&&(window.dispatchEvent(new CustomEvent("direct-message-sent",{detail:{message:a,contact:o}})),setTimeout(()=>{F({title:"¡Mensaje enviado exitosamente!",description:`Destinatario: ${o}

Se ha enviado tu solicitud de pedido. El negocio se pondrá en contacto contigo pronto.`,variant:"success",duration:6e3})},500)),{success:!0,status:"pending",message:`Mensaje enviado exitosamente: "${a}"`}},$e=async e=>{try{if(!{}.PUBLIC_TROPIPAY_API_KEY)return console.error("Falta la API key de Tropipay"),{success:!1,message:"Error de configuración: No se pueden procesar pagos con Tropipay en este momento"};const o=await(await fetch("https://tropipay.com/api/v2/paymentcards",{method:"POST",headers:{Authorization:`Bearer ${{}.PUBLIC_TROPIPAY_API_KEY}`,"Content-Type":"application/json"},body:JSON.stringify({reference:e.orderId||Date.now().toString(),concept:e.concept,description:e.concept,currency:e.currency,amount:e.amount,singleUse:!0,redirectUrl:`${window.location.origin}/payment/success`})})).json();if(o.paymentUrl)return window.location.href=o.paymentUrl,{success:!0,message:"Redirigiendo a Tropipay",transactionId:o.reference};throw new Error("No se pudo crear la tarjeta de pago")}catch(a){return console.error("Error al procesar pago con Tropipay:",a),{success:!1,message:"Error al procesar el pago con Tropipay"}}},ze=async e=>{try{if(!{}.PUBLIC_ENZONA_ACCESS_TOKEN||!{}.PUBLIC_ENZONA_MERCHANT_UUID)return console.error("Faltan variables de entorno para EnZona"),{success:!1,message:"Error de configuración: No se pueden procesar pagos con EnZona en este momento"};const o=await(await fetch("https://api.enzona.net/payment/v1.0.0/payments",{method:"POST",headers:{Authorization:`Bearer ${{}.PUBLIC_ENZONA_ACCESS_TOKEN}`,"Content-Type":"application/json"},body:JSON.stringify({merchant_uuid:{}.PUBLIC_ENZONA_MERCHANT_UUID,currency:"CUP",amount:e.amount,description:e.concept,return_url:`${window.location.origin}/payment/success`,cancel_url:`${window.location.origin}/payment/cancel`})})).json();if(o.payment_url)return window.location.href=o.payment_url,{success:!0,message:"Redirigiendo a Enzona",transactionId:o.transaction_uuid};throw new Error("No se pudo crear el pago en Enzona")}catch(a){return console.error("Error al procesar pago con Enzona:",a),{success:!1,message:"Error al procesar el pago con Enzona"}}},Le=async e=>{try{if(!{}.PUBLIC_TRANSFERMOVIL_API_KEY)return console.error("Falta la API key de Transfermóvil"),{success:!1,message:"Error de configuración: No se pueden procesar pagos con Transfermóvil en este momento"};const o=await(await fetch("https://api.transfermovil.com/payment",{method:"POST",headers:{Authorization:`Bearer ${{}.PUBLIC_TRANSFERMOVIL_API_KEY}`,"Content-Type":"application/json"},body:JSON.stringify({amount:e.amount,currency:"CUP",description:e.concept,returnUrl:`${window.location.origin}/payment/success`})})).json();if(o.paymentUrl)return window.location.href=o.paymentUrl,{success:!0,message:"Redirigiendo a Transfermóvil",transactionId:o.transactionId};throw new Error("No se pudo crear el pago en Transfermóvil")}catch(a){return console.error("Error al procesar pago con Transfermóvil:",a),{success:!1,message:"Error al procesar el pago con Transfermóvil"}}},Be=async e=>({success:!1,message:"Método de pago en implementación"}),Fe=[{id:"whatsapp",name:"WhatsApp",icon:Ee,description:"Coordina el pedido directamente por WhatsApp",processor:ke},{id:"directMessage",name:"Mensaje Directo",icon:Te,description:"Coordina el pedido directamente por correo electrónico",processor:Ie}],He=[...Fe,{id:"card",name:"Tarjeta de Crédito/Débito",icon:me,description:"Paga de forma segura con tu tarjeta",processor:Be},{id:"tropipay",name:"Tropipay",icon:_e,description:"Paga usando tu cuenta de Tropipay",processor:$e},{id:"local",name:"Pagos Locales",icon:C,description:"Métodos de pago disponibles solo en Cuba",countryRestriction:"CU",processor:async e=>({success:!1,message:"Por favor selecciona un método de pago local específico"}),children:[{id:"enzona",name:"Enzona",icon:C,description:"Paga con tu cuenta de Enzona",countryRestriction:"CU",processor:ze},{id:"transfermovil",name:"Transfermóvil",icon:C,description:"Paga con Transfermóvil",countryRestriction:"CU",processor:Le}]}],y={invalid_token:"La sesión ha expirado. Por favor, inicia el proceso de pago nuevamente.",unauthorized:"No tienes permiso para realizar esta operación.",not_found:"No se encontró la transacción solicitada.",insufficient_funds:"Fondos insuficientes para realizar la operación.",invalid_amount:"El monto del pago es inválido.",duplicate_transaction:"Ya existe una transacción con este identificador.",service_unavailable:"El servicio de pago no está disponible en este momento.",network_error:"Error de conexión con el servicio de pago.",timeout:"La operación ha excedido el tiempo de espera.",invalid_data:"Los datos proporcionados son inválidos.",default:"Error al procesar el pago. Por favor, intenta nuevamente."};function We({transactionId:e,merchantOpId:a,errorCode:o,errorMessage:t,onRetry:i}){const[m,l]=n.useState(!!t);n.useEffect(()=>{l(!!t),t&&!o?.includes("critical")&&F({title:"Error en la transacción",description:d(),variant:"destructive"}),t&&E()},[t,o]);const d=()=>!t&&!o?y.default:o&&y[o]?y[o]:t||y.default,E=()=>{console.error("Error de pago:",{transactionId:e,merchantOpId:a,errorCode:o,errorMessage:t,timestamp:new Date().toISOString(),userAgent:navigator.userAgent})},b=()=>{l(!1)},T=()=>{l(!1),i&&i()};return!t&&!o?null:s.jsx(s.Fragment,{children:s.jsx(ge,{open:m,onOpenChange:l,children:s.jsxs(he,{children:[s.jsxs(fe,{children:[s.jsx(xe,{className:"text-destructive",children:"Error en el Procesamiento de Pago"}),s.jsx(ye,{children:s.jsxs("div",{className:"space-y-4 py-3",children:[s.jsxs("div",{className:"flex items-start",children:[s.jsx("div",{className:"flex-shrink-0 mt-0.5",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-destructive",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),s.jsx("div",{className:"ml-3",children:s.jsx("p",{className:"text-sm text-destructive font-medium",children:d()})})]}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"Por favor, intenta nuevamente o utiliza otro método de pago. Si el problema persiste, contacta con nuestro soporte técnico."}),(e||a)&&s.jsxs("div",{className:"border-t border-gray-200 pt-4 mt-4",children:[s.jsx("h4",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Información de Referencia:"}),s.jsxs("div",{className:"bg-muted p-2 rounded text-xs font-mono",children:[e&&s.jsxs("div",{children:["ID Transacción: ",e]}),a&&s.jsxs("div",{children:["ID Orden: ",a]}),o&&s.jsxs("div",{children:["Código: ",o]})]})]})]})})]}),s.jsxs(ve,{children:[s.jsx(k,{onClick:b,children:"Cerrar"}),i&&s.jsx(k,{onClick:T,className:"bg-primary hover:bg-primary/90",children:"Intentar Nuevamente"})]})]})})})}function rs({isOpen:e,onClose:a,amount:o,currency:t="USD",concept:i,onPaymentComplete:m,customerInfo:l=null,metadata:d,paymentMethods:E,businessPhone:b,businessContact:T}){const[p,G]=n.useState(null),[O,P]=n.useState(!1),[_,R]=n.useState(null),[X,h]=n.useState(null),[Q,f]=n.useState(null),[ee,se]=n.useState(null),oe=E||He,ae=r=>{G(r),r.id!=="local"&&R(null),h(null),f(null)},w=async r=>{r&&r.preventDefault(),P(!0),h(null),f(null);try{const u=_||p,ne=Date.now().toString(),g=await u.processor({amount:o,currency:t,concept:i,orderId:ne,customerInfo:l,metadata:d,businessPhone:b,businessContact:T});if(g.transactionId&&se(g.transactionId),!g.success){h(g.message),f(g.errorCode||"payment_failed"),P(!1);return}m(g)}catch(u){console.error("Error al procesar el pago:",u),u.message&&u.message.includes("process is not defined")?(f("config_error"),h("Error de configuración en el sistema de pagos. Por favor contacta al soporte.")):(f("unknown_error"),h(u.message||"Hubo un error al procesar el pago")),m({success:!1,message:u.message||"Hubo un error al procesar el pago"})}finally{P(!1)}},te=()=>{w()},re=()=>p?.id==="local"?s.jsxs("div",{className:"space-y-4",children:[s.jsx(q,{children:s.jsx(J,{children:"Estos métodos de pago solo están disponibles para usuarios en Cuba."})}),s.jsx("div",{className:"grid grid-cols-2 gap-4",children:p.children.map(r=>s.jsx(U,{className:`p-4 cursor-pointer transition-all ${_?.id===r.id?"border-2 border-primary bg-primary/5 shadow-sm":"border-transparent hover:border-primary/20 hover:bg-muted/50"}`,onClick:()=>R(r),children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"p-2 rounded-full bg-primary/10",children:s.jsx(r.icon,{className:"h-6 w-6 text-primary"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium",children:r.name}),s.jsx("p",{className:"text-sm text-muted-foreground",children:r.description})]})]})},r.id))})]}):p?.id==="card"?s.jsxs("form",{onSubmit:w,className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(S,{htmlFor:"cardNumber",children:"Número de tarjeta"}),s.jsx(A,{id:"cardNumber",placeholder:"1234 5678 9012 3456",required:!0})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(S,{htmlFor:"expiry",children:"Fecha de expiración"}),s.jsx(A,{id:"expiry",placeholder:"MM/YY",required:!0})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(S,{htmlFor:"cvc",children:"CVC"}),s.jsx(A,{id:"cvc",placeholder:"123",required:!0})]})]})]}):null;return s.jsxs(s.Fragment,{children:[s.jsx(Me,{open:e,onOpenChange:a,children:s.jsxs(W,{className:"sm:max-w-[500px]",children:[s.jsxs(Y,{children:[s.jsx(Z,{children:"Selecciona el método de pago"}),s.jsxs(K,{children:["Monto a pagar: ",o," ",t]})]}),s.jsxs("div",{className:"grid gap-4 py-4",children:[s.jsx("div",{className:"grid grid-cols-1 gap-4",children:oe.filter(r=>d?.type==="product_purchase"?!0:(d?.type==="plan_subscription",r.id!=="directMessage")).map(r=>s.jsx(U,{className:`p-4 cursor-pointer transition-all ${p?.id===r.id?"border-2 border-primary bg-primary/5 shadow-sm":"border-transparent hover:border-primary/20 hover:bg-muted/50"}`,onClick:()=>ae(r),children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"p-2 rounded-full bg-primary/10",children:s.jsx(r.icon,{className:"h-6 w-6 text-primary"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium",children:r.name}),s.jsx("p",{className:"text-sm text-muted-foreground",children:r.description})]})]})},r.id))}),re()]}),s.jsx(V,{children:s.jsx(pe,{onClick:w,disabled:!p||p.id==="local"&&!_||O,children:O?"Procesando...":"Continuar con el pago"})})]})}),s.jsx(We,{errorMessage:X,errorCode:Q,transactionId:ee,merchantOpId:d?.orderId,onRetry:te})]})}export{rs as P,Fe as p,ts as u};
