import{r as n}from"./index.a383d3d5.js";import{j as t,c as i}from"./utils.1a4f1886.js";import{O as M,C as O,a as W,X as q,T as D,D as k,P as J,R as K}from"./index.d7d0bd85.js";import{B as Z}from"./button.45d40932.js";import{C as P}from"./card.9cf3ca2d.js";import{I as x}from"./input.10ac0355.js";import{L as v}from"./label.ddf0c103.js";import{c as X}from"./index.3cab87fc.js";import{C as G}from"./credit-card.85f76a2c.js";import{c as w}from"./createLucideIcon.42681ef6.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]],N=w("Building",Q);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]],ae=w("MessageCircle",ee);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],te=w("Wallet",se);function Pe(e={}){const[a,s]=n.useState(!1),[o,d]=n.useState(!1),[m,u]=n.useState(null);return{isOpen:a,loading:o,error:m,setIsOpen:s,handlePayment:async l=>{s(!0),u(null)},handlePaymentComplete:l=>{if(d(!1),s(!1),l.success)e.onSuccess?.(l);else{const g=new Error(l.message);u(l.message),e.onError?.(g)}e.onComplete?.()}}}const re=1,oe=1e6;let j=0;function ne(){return j=(j+1)%Number.MAX_SAFE_INTEGER,j.toString()}const T=new Map,_=e=>{if(T.has(e))return;const a=setTimeout(()=>{T.delete(e),p({type:"REMOVE_TOAST",toastId:e})},oe);T.set(e,a)},ie=(e,a)=>{switch(a.type){case"ADD_TOAST":return{...e,toasts:[a.toast,...e.toasts].slice(0,re)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(s=>s.id===a.toast.id?{...s,...a.toast}:s)};case"DISMISS_TOAST":{const{toastId:s}=a;return s?_(s):e.toasts.forEach(o=>{_(o.id)}),{...e,toasts:e.toasts.map(o=>o.id===s||s===void 0?{...o,open:!1}:o)}}case"REMOVE_TOAST":return a.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(s=>s.id!==a.toastId)}}},f=[];let y={toasts:[]};function p(e){y=ie(y,e),f.forEach(a=>{a(y)})}function ce({...e}){const a=ne(),s=d=>p({type:"UPDATE_TOAST",toast:{...d,id:a}}),o=()=>p({type:"DISMISS_TOAST",toastId:a});return p({type:"ADD_TOAST",toast:{...e,id:a,open:!0,onOpenChange:d=>{d||o()}}}),{id:a,dismiss:o,update:s}}function _e(){const[e,a]=n.useState(y);return n.useEffect(()=>(f.push(a),()=>{const s=f.indexOf(a);s>-1&&f.splice(s,1)}),[e]),{...e,toast:ce,dismiss:s=>p({type:"DISMISS_TOAST",toastId:s})}}const de=K,le=J,R=n.forwardRef(({className:e,...a},s)=>t.jsx(M,{ref:s,className:i("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...a}));R.displayName=M.displayName;const I=n.forwardRef(({className:e,children:a,...s},o)=>t.jsxs(le,{children:[t.jsx(R,{}),t.jsxs(O,{ref:o,className:i("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...s,children:[a,t.jsxs(W,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[t.jsx(q,{className:"h-4 w-4"}),t.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));I.displayName=O.displayName;const U=({className:e,...a})=>t.jsx("div",{className:i("flex flex-col space-y-1.5 text-center sm:text-left",e),...a});U.displayName="DialogHeader";const z=({className:e,...a})=>t.jsx("div",{className:i("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...a});z.displayName="DialogFooter";const $=n.forwardRef(({className:e,...a},s)=>t.jsx(D,{ref:s,className:i("text-lg font-semibold leading-none tracking-tight",e),...a}));$.displayName=D.displayName;const L=n.forwardRef(({className:e,...a},s)=>t.jsx(k,{ref:s,className:i("text-sm text-muted-foreground",e),...a}));L.displayName=k.displayName;const pe=X("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),F=n.forwardRef(({className:e,variant:a,...s},o)=>t.jsx("div",{ref:o,role:"alert",className:i(pe({variant:a}),e),...s}));F.displayName="Alert";const me=n.forwardRef(({className:e,...a},s)=>t.jsx("h5",{ref:s,className:i("mb-1 font-medium leading-none tracking-tight",e),...a}));me.displayName="AlertTitle";const V=n.forwardRef(({className:e,...a},s)=>t.jsx("div",{ref:s,className:i("text-sm [&_p]:leading-relaxed",e),...a}));V.displayName="AlertDescription";const ue=async e=>{const a=`Hola, me interesa realizar un pago por ${e.amount} ${e.currency} para ${e.concept}`,s=`https://wa.me/5350698123?text=${encodeURIComponent(a)}`;return window.open(s,"_blank"),{success:!0,status:"pending",message:"Tu solicitud de pago ha sido registrada. Pronto nos comunicaremos contigo para confirmar el proceso. Por favor, mantén tu WhatsApp disponible."}},ge=async e=>{try{const s=await(await fetch("https://tropipay.com/api/v2/paymentcards",{method:"POST",headers:{Authorization:`Bearer ${{}.TROPIPAY_API_KEY}`,"Content-Type":"application/json"},body:JSON.stringify({reference:e.orderId||Date.now().toString(),concept:e.concept,description:e.concept,currency:e.currency,amount:e.amount,singleUse:!0,redirectUrl:`${window.location.origin}/payment/success`})})).json();if(s.paymentUrl)return window.location.href=s.paymentUrl,{success:!0,message:"Redirigiendo a Tropipay",transactionId:s.reference};throw new Error("No se pudo crear la tarjeta de pago")}catch(a){return console.error("Error al procesar pago con Tropipay:",a),{success:!1,message:"Error al procesar el pago con Tropipay"}}},he=async e=>{try{const s=await(await fetch("https://api.enzona.net/payment/v1.0.0/payments",{method:"POST",headers:{Authorization:`Bearer ${{}.ENZONA_ACCESS_TOKEN}`,"Content-Type":"application/json"},body:JSON.stringify({merchant_uuid:{}.ENZONA_MERCHANT_UUID,currency:"CUP",amount:e.amount,description:e.concept,return_url:`${window.location.origin}/payment/success`,cancel_url:`${window.location.origin}/payment/cancel`})})).json();if(s.payment_url)return window.location.href=s.payment_url,{success:!0,message:"Redirigiendo a Enzona",transactionId:s.transaction_uuid};throw new Error("No se pudo crear el pago en Enzona")}catch(a){return console.error("Error al procesar pago con Enzona:",a),{success:!1,message:"Error al procesar el pago con Enzona"}}},fe=async e=>{try{const s=await(await fetch("https://api.transfermovil.com/payment",{method:"POST",headers:{Authorization:`Bearer ${{}.TRANSFERMOVIL_API_KEY}`,"Content-Type":"application/json"},body:JSON.stringify({amount:e.amount,currency:"CUP",description:e.concept,returnUrl:`${window.location.origin}/payment/success`})})).json();if(s.paymentUrl)return window.location.href=s.paymentUrl,{success:!0,message:"Redirigiendo a Transfermóvil",transactionId:s.transactionId};throw new Error("No se pudo crear el pago en Transfermóvil")}catch(a){return console.error("Error al procesar pago con Transfermóvil:",a),{success:!1,message:"Error al procesar el pago con Transfermóvil"}}},ye=async e=>({success:!1,message:"Método de pago en implementación"}),xe=[{id:"card",name:"Tarjeta de Crédito/Débito",icon:G,description:"Paga de forma segura con tu tarjeta",processor:ye},{id:"whatsapp",name:"Vía WhatsApp",icon:ae,description:"Coordina el pago con nuestro agente comercial",processor:ue},{id:"tropipay",name:"Tropipay",icon:te,description:"Paga usando tu cuenta de Tropipay",processor:ge},{id:"local",name:"Pagos Locales",icon:N,description:"Métodos de pago disponibles solo en Cuba",countryRestriction:"CU",processor:async e=>({success:!1,message:"Por favor selecciona un método de pago local específico"}),children:[{id:"enzona",name:"Enzona",icon:N,description:"Paga con tu cuenta de Enzona",countryRestriction:"CU",processor:he},{id:"transfermovil",name:"Transfermóvil",icon:N,description:"Paga con Transfermóvil",countryRestriction:"CU",processor:fe}]}];function Me({isOpen:e,onClose:a,amount:s,currency:o="USD",concept:d,onPaymentComplete:m,customerInfo:u,metadata:S}){const[c,l]=n.useState(null),[g,E]=n.useState(!1),[h,b]=n.useState(null),B=r=>{l(r),r.id!=="local"&&b(null)},C=async r=>{r.preventDefault(),E(!0);try{const Y=await(h||c).processor({amount:s,currency:o,concept:d,orderId:Date.now().toString(),customerInfo:u,metadata:S});m(Y)}catch(A){console.error("Error al procesar el pago:",A),m({success:!1,message:"Hubo un error al procesar el pago"})}finally{E(!1)}},H=()=>c?.id==="local"&&!h?t.jsxs("div",{className:"space-y-4",children:[t.jsx(F,{children:t.jsx(V,{children:"Estos métodos de pago solo están disponibles para usuarios en Cuba."})}),t.jsx("div",{className:"grid grid-cols-1 gap-4",children:c.children.map(r=>t.jsx(P,{className:`p-4 cursor-pointer transition-all ${h?.id===r.id?"border-primary ring-2 ring-primary/20":"hover:border-primary/50"}`,onClick:()=>b(r),children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"p-2 rounded-full bg-primary/10",children:t.jsx(r.icon,{className:"h-6 w-6 text-primary"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium",children:r.name}),t.jsx("p",{className:"text-sm text-muted-foreground",children:r.description})]})]})},r.id))})]}):c?.id==="card"?t.jsxs("form",{onSubmit:C,className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(v,{htmlFor:"cardNumber",children:"Número de tarjeta"}),t.jsx(x,{id:"cardNumber",placeholder:"1234 5678 9012 3456",required:!0})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(v,{htmlFor:"expiry",children:"Fecha de expiración"}),t.jsx(x,{id:"expiry",placeholder:"MM/YY",required:!0})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(v,{htmlFor:"cvc",children:"CVC"}),t.jsx(x,{id:"cvc",placeholder:"123",required:!0})]})]})]}):null;return t.jsx(de,{open:e,onOpenChange:a,children:t.jsxs(I,{className:"sm:max-w-[500px]",children:[t.jsxs(U,{children:[t.jsx($,{children:"Selecciona el método de pago"}),t.jsxs(L,{children:["Monto a pagar: ",s," ",o]})]}),t.jsxs("div",{className:"grid gap-4 py-4",children:[t.jsx("div",{className:"grid grid-cols-1 gap-4",children:xe.map(r=>t.jsx(P,{className:`p-4 cursor-pointer transition-all ${c?.id===r.id?"border-primary ring-2 ring-primary/20":"hover:border-primary/50"}`,onClick:()=>B(r),children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"p-2 rounded-full bg-primary/10",children:t.jsx(r.icon,{className:"h-6 w-6 text-primary"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium",children:r.name}),t.jsx("p",{className:"text-sm text-muted-foreground",children:r.description})]})]})},r.id))}),H()]}),t.jsx(z,{children:t.jsx(Z,{onClick:C,disabled:!c||c.id==="local"&&!h||g,children:g?"Procesando...":"Continuar con el pago"})})]})})}export{Me as P,Pe as a,_e as u};
